<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../../../img/favicon.ico">
        <title>To Mezzio 1.1 - mezzio</title>
        <link href="../../../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
        <link href="../../../../css/mezzio.css" rel="stylesheet">

        <script src="../../../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../../../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../../../..">mezzio</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../../../.." class="nav-link">Home</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">v3 <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../../../v3/" class="dropdown-item">Introduction</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Getting Started</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../../v3/getting-started/features/" class="dropdown-item">Overview and Features</a>
</li>
            
<li>
    <a href="../../../../v3/getting-started/quick-start/" class="dropdown-item">Quick Start</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Features</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../../v3/features/middleware-types/" class="dropdown-item">Middleware Types</a>
</li>
            
<li>
    <a href="../../../../v3/features/application/" class="dropdown-item">Applications</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Containers</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../../v3/features/container/intro/" class="dropdown-item">Introduction</a>
</li>
            
<li>
    <a href="../../../../v3/features/container/factories/" class="dropdown-item">Container Factories</a>
</li>
            
<li>
    <a href="../../../../v3/features/container/delegator-factories/" class="dropdown-item">Delegator Factories</a>
</li>
            
<li>
    <a href="../../../../v3/features/container/middleware-container/" class="dropdown-item">The Middleware Container</a>
</li>
            
<li>
    <a href="../../../../v3/features/container/middleware-factory/" class="dropdown-item">The Middleware Factory</a>
</li>
            
<li>
    <a href="../../../../v3/features/container/laminas-servicemanager/" class="dropdown-item">Using laminas-servicemanager</a>
</li>
            
<li>
    <a href="../../../../v3/features/container/pimple/" class="dropdown-item">Using Pimple</a>
</li>
            
<li>
    <a href="../../../../v3/features/container/aura-di/" class="dropdown-item">Using Aura.Di</a>
</li>
            
<li>
    <a href="../../../../v3/features/container/config/" class="dropdown-item">Container configuration</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Routing Adapters</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../../v3/features/router/intro/" class="dropdown-item">Introduction</a>
</li>
            
<li>
    <a href="../../../../v3/features/router/interface/" class="dropdown-item">Routing Interface</a>
</li>
            
<li>
    <a href="../../../../v3/features/router/route-collector/" class="dropdown-item">The Route Collector</a>
</li>
            
<li>
    <a href="../../../../v3/features/router/uri-generation/" class="dropdown-item">URI Generation</a>
</li>
            
<li>
    <a href="../../../../v3/features/router/piping/" class="dropdown-item">Routing vs Piping</a>
</li>
            
<li>
    <a href="../../../../v3/features/router/aura/" class="dropdown-item">Using Aura</a>
</li>
            
<li>
    <a href="../../../../v3/features/router/fast-route/" class="dropdown-item">Using FastRoute</a>
</li>
            
<li>
    <a href="../../../../v3/features/router/laminas-router/" class="dropdown-item">Using laminas-router</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Templating</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../../v3/features/template/intro/" class="dropdown-item">Introduction</a>
</li>
            
<li>
    <a href="../../../../v3/features/template/interface/" class="dropdown-item">Template Renderer Interface</a>
</li>
            
<li>
    <a href="../../../../v3/features/template/request-handlers/" class="dropdown-item">Templated Request Handlers</a>
</li>
            
<li>
    <a href="../../../../v3/features/template/plates/" class="dropdown-item">Using Plates</a>
</li>
            
<li>
    <a href="../../../../v3/features/template/twig/" class="dropdown-item">Using Twig</a>
</li>
            
<li>
    <a href="../../../../v3/features/template/laminas-view/" class="dropdown-item">Using laminas-view</a>
</li>
    </ul>
  </li>
            
<li>
    <a href="../../../../v3/features/error-handling/" class="dropdown-item">Error Handling</a>
</li>
            
<li>
    <a href="../../../../v3/features/modular-applications/" class="dropdown-item">Modular Applications</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Middleware</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../../v3/features/middleware/routing-and-dispatch-middleware/" class="dropdown-item">Routing and Dispatch Middleware</a>
</li>
            
<li>
    <a href="../../../../v3/features/middleware/implicit-methods-middleware/" class="dropdown-item">Implicit HEAD and OPTIONS Middleware</a>
</li>
            
<li>
    <a href="../../../../v3/features/middleware/method-not-allowed-middleware/" class="dropdown-item">Returning Method Not Allowed</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Helpers</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../../v3/features/helpers/intro/" class="dropdown-item">Introduction</a>
</li>
            
<li>
    <a href="../../../../v3/features/helpers/url-helper/" class="dropdown-item">UrlHelper</a>
</li>
            
<li>
    <a href="../../../../v3/features/helpers/server-url-helper/" class="dropdown-item">ServerUrlHelper</a>
</li>
            
<li>
    <a href="../../../../v3/features/helpers/body-parse/" class="dropdown-item">Body Parsing Middleware</a>
</li>
            
<li>
    <a href="../../../../v3/features/helpers/content-length/" class="dropdown-item">Content-Length Middleware</a>
</li>
            
<li>
    <a href="../../../../v3/features/helpers/template-variable-container/" class="dropdown-item">Template Variable Container</a>
</li>
    </ul>
  </li>
            
<li>
    <a href="../../../../v3/features/emitters/" class="dropdown-item">Emitters</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Cookbook</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../../v3/cookbook/autowiring-routes-and-pipelines/" class="dropdown-item">Autowiring routes and pipeline middleware</a>
</li>
            
<li>
    <a href="../../../../v3/cookbook/using-a-base-path/" class="dropdown-item">Using Mezzio from a subdirectory</a>
</li>
            
<li>
    <a href="../../../../v3/cookbook/common-prefix-for-routes/" class="dropdown-item">Prepending a common path to all routes</a>
</li>
            
<li>
    <a href="../../../../v3/cookbook/passing-data-between-middleware/" class="dropdown-item">Passing data between middleware</a>
</li>
            
<li>
    <a href="../../../../v3/cookbook/path-segregated-routing/" class="dropdown-item">Path-segregated routing</a>
</li>
            
<li>
    <a href="../../../../v3/cookbook/access-common-data-in-templates/" class="dropdown-item">Provide Access to Common Data In Templates</a>
</li>
            
<li>
    <a href="../../../../v3/cookbook/route-specific-pipeline/" class="dropdown-item">Route-specific middleware pipelines</a>
</li>
            
<li>
    <a href="../../../../v3/cookbook/host-segregated-middleware/" class="dropdown-item">Segregating middleware by host</a>
</li>
            
<li>
    <a href="../../../../v3/cookbook/double-pass-middleware/" class="dropdown-item">Using double-pass middleware</a>
</li>
            
<li>
    <a href="../../../../v3/cookbook/setting-locale-depending-routing-parameter/" class="dropdown-item">Setting a locale based on a routing parameter</a>
</li>
            
<li>
    <a href="../../../../v3/cookbook/setting-locale-without-routing-parameter/" class="dropdown-item">Setting a locale without a routing parameter</a>
</li>
            
<li>
    <a href="../../../../v3/cookbook/debug-toolbars/" class="dropdown-item">Enabling debug toolbars</a>
</li>
            
<li>
    <a href="../../../../v3/cookbook/flash-messengers/" class="dropdown-item">Flash Messengers</a>
</li>
            
<li>
    <a href="../../../../v3/cookbook/using-custom-view-helpers/" class="dropdown-item">Registering custom view helpers when using laminas-view</a>
</li>
            
<li>
    <a href="../../../../v3/cookbook/using-laminas-form-view-helpers/" class="dropdown-item">Using laminas-form view helpers</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Reference</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../../v3/why-mezzio/" class="dropdown-item">Why choose Mezzio?</a>
</li>
            
<li>
    <a href="../../../../v3/reference/cli-tooling/" class="dropdown-item">CLI Tooling</a>
</li>
            
<li>
    <a href="../../../../v3/reference/mezzio-projects/" class="dropdown-item">Mezzio Projects</a>
</li>
            
<li>
    <a href="../../../../v3/reference/migration/" class="dropdown-item">Migration</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">v2 <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../../../v2/" class="dropdown-item">Mezzio: PSR-7 Middleware in Minutes</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Getting Started</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../../v2/getting-started/features/" class="dropdown-item">Overview and Features</a>
</li>
            
<li>
    <a href="../../../../v2/getting-started/standalone/" class="dropdown-item">Quick Start: Standalone</a>
</li>
            
<li>
    <a href="../../../../v2/getting-started/skeleton/" class="dropdown-item">Quick Start: Skeleton Installer</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Features</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../../v2/features/middleware-types/" class="dropdown-item">Middleware Types</a>
</li>
            
<li>
    <a href="../../../../v2/features/application/" class="dropdown-item">Applications</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Containers</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../../v2/features/container/intro/" class="dropdown-item">Introduction</a>
</li>
            
<li>
    <a href="../../../../v2/features/container/factories/" class="dropdown-item">Container Factories</a>
</li>
            
<li>
    <a href="../../../../v2/features/container/delegator-factories/" class="dropdown-item">Delegator Factories</a>
</li>
            
<li>
    <a href="../../../../v2/features/container/laminas-servicemanager/" class="dropdown-item">Using laminas-servicemanager</a>
</li>
            
<li>
    <a href="../../../../v2/features/container/pimple/" class="dropdown-item">Using Pimple</a>
</li>
            
<li>
    <a href="../../../../v2/features/container/aura-di/" class="dropdown-item">Using Aura.Di</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Routing Adapters</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../../v2/features/router/intro/" class="dropdown-item">Introduction</a>
</li>
            
<li>
    <a href="../../../../v2/features/router/interface/" class="dropdown-item">Routing Interface</a>
</li>
            
<li>
    <a href="../../../../v2/features/router/uri-generation/" class="dropdown-item">URI Generation</a>
</li>
            
<li>
    <a href="../../../../v2/features/router/piping/" class="dropdown-item">Routing vs Piping</a>
</li>
            
<li>
    <a href="../../../../v2/features/router/aura/" class="dropdown-item">Using Aura</a>
</li>
            
<li>
    <a href="../../../../v2/features/router/fast-route/" class="dropdown-item">Using FastRoute</a>
</li>
            
<li>
    <a href="../../../../v2/features/router/laminas-router/" class="dropdown-item">Using the Laminas Router</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Templating</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../../v2/features/template/intro/" class="dropdown-item">Introduction</a>
</li>
            
<li>
    <a href="../../../../v2/features/template/interface/" class="dropdown-item">Template Renderer Interface</a>
</li>
            
<li>
    <a href="../../../../v2/features/template/middleware/" class="dropdown-item">Templated Middleware</a>
</li>
            
<li>
    <a href="../../../../v2/features/template/plates/" class="dropdown-item">Using Plates</a>
</li>
            
<li>
    <a href="../../../../v2/features/template/twig/" class="dropdown-item">Using Twig</a>
</li>
            
<li>
    <a href="../../../../v2/features/template/laminas-view/" class="dropdown-item">Using laminas-view</a>
</li>
    </ul>
  </li>
            
<li>
    <a href="../../../../v2/features/error-handling/" class="dropdown-item">Error Handling</a>
</li>
            
<li>
    <a href="../../../../v2/features/modular-applications/" class="dropdown-item">Modular Applications</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Middleware</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../../v2/features/middleware/implicit-methods-middleware/" class="dropdown-item">Implicit HEAD and OPTIONS Middleware</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Helpers</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../../v2/features/helpers/intro/" class="dropdown-item">Introduction</a>
</li>
            
<li>
    <a href="../../../../v2/features/helpers/url-helper/" class="dropdown-item">UrlHelper</a>
</li>
            
<li>
    <a href="../../../../v2/features/helpers/server-url-helper/" class="dropdown-item">ServerUrlHelper</a>
</li>
            
<li>
    <a href="../../../../v2/features/helpers/body-parse/" class="dropdown-item">Body Parsing Middleware</a>
</li>
            
<li>
    <a href="../../../../v2/features/helpers/content-length/" class="dropdown-item">Content-Length Middleware</a>
</li>
    </ul>
  </li>
            
<li>
    <a href="../../../../v2/features/emitters/" class="dropdown-item">Emitters</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Cookbook</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../../v2/cookbook/autowiring-routes-and-pipelines/" class="dropdown-item">Autowiring routes and pipeline middleware</a>
</li>
            
<li>
    <a href="../../../../v2/cookbook/common-prefix-for-routes/" class="dropdown-item">Prepending a common path to all routes</a>
</li>
            
<li>
    <a href="../../../../v2/cookbook/route-specific-pipeline/" class="dropdown-item">Route-specific middleware pipelines</a>
</li>
            
<li>
    <a href="../../../../v2/cookbook/using-custom-view-helpers/" class="dropdown-item">Registering custom view helpers when using laminas-view</a>
</li>
            
<li>
    <a href="../../../../v2/cookbook/using-laminas-form-view-helpers/" class="dropdown-item">Using laminas-form view helpers</a>
</li>
            
<li>
    <a href="../../../../v2/cookbook/using-a-base-path/" class="dropdown-item">Using Mezzio from a subdirectory</a>
</li>
            
<li>
    <a href="../../../../v2/cookbook/setting-locale-depending-routing-parameter/" class="dropdown-item">Setting a locale based on a routing parameter</a>
</li>
            
<li>
    <a href="../../../../v2/cookbook/setting-locale-without-routing-parameter/" class="dropdown-item">Setting a locale without a routing parameter</a>
</li>
            
<li>
    <a href="../../../../v2/cookbook/debug-toolbars/" class="dropdown-item">Enabling debug toolbars</a>
</li>
            
<li>
    <a href="../../../../v2/cookbook/using-routed-middleware-class-as-controller/" class="dropdown-item">Handling multiple routes in a single class</a>
</li>
            
<li>
    <a href="../../../../v2/cookbook/flash-messengers/" class="dropdown-item">Flash Messengers</a>
</li>
            
<li>
    <a href="../../../../v2/cookbook/passing-data-between-middleware/" class="dropdown-item">Passing data between middleware</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Reference</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../../v2/why-mezzio/" class="dropdown-item">Why choose Mezzio?</a>
</li>
            
<li>
    <a href="../../../../v2/reference/cli-tooling/" class="dropdown-item">CLI Tooling</a>
</li>
            
<li>
    <a href="../../../../v2/reference/usage-examples/" class="dropdown-item">Examples</a>
</li>
            
<li>
    <a href="../../../../v2/reference/mezzio-projects/" class="dropdown-item">Mezzio Projects</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Migration</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../../v2/reference/migration/" class="dropdown-item">To version 2</a>
</li>
            
<li>
    <a href="../../../../v2/reference/migration-to-v2-2/" class="dropdown-item">To version 2.2</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">v1 <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../../" class="dropdown-item">Mezzio: PSR-7 Middleware in Minutes</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Getting Started</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../getting-started/features/" class="dropdown-item">Overview and Features</a>
</li>
            
<li>
    <a href="../../../getting-started/standalone/" class="dropdown-item">Quick Start: Standalone</a>
</li>
            
<li>
    <a href="../../../getting-started/skeleton/" class="dropdown-item">Quick Start: Skeleton Installer</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Features</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../features/application/" class="dropdown-item">Applications</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Containers</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../features/container/intro/" class="dropdown-item">Introduction</a>
</li>
            
<li>
    <a href="../../../features/container/factories/" class="dropdown-item">Container Factories</a>
</li>
            
<li>
    <a href="../../../features/container/laminas-servicemanager/" class="dropdown-item">Using laminas-servicemanager</a>
</li>
            
<li>
    <a href="../../../features/container/pimple/" class="dropdown-item">Using Pimple</a>
</li>
            
<li>
    <a href="../../../features/container/aura-di/" class="dropdown-item">Using Aura.Di</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Routing Adapters</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../features/router/intro/" class="dropdown-item">Introduction</a>
</li>
            
<li>
    <a href="../../../features/router/interface/" class="dropdown-item">Routing Interface</a>
</li>
            
<li>
    <a href="../../../features/router/uri-generation/" class="dropdown-item">URI Generation</a>
</li>
            
<li>
    <a href="../../../features/router/piping/" class="dropdown-item">Routing vs Piping</a>
</li>
            
<li>
    <a href="../../../features/router/aura/" class="dropdown-item">Using Aura</a>
</li>
            
<li>
    <a href="../../../features/router/fast-route/" class="dropdown-item">Using FastRoute</a>
</li>
            
<li>
    <a href="../../../features/router/laminas-router/" class="dropdown-item">Using the Laminas Router</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Templating</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../features/template/intro/" class="dropdown-item">Introduction</a>
</li>
            
<li>
    <a href="../../../features/template/interface/" class="dropdown-item">Template Renderer Interface</a>
</li>
            
<li>
    <a href="../../../features/template/middleware/" class="dropdown-item">Templated Middleware</a>
</li>
            
<li>
    <a href="../../../features/template/plates/" class="dropdown-item">Using Plates</a>
</li>
            
<li>
    <a href="../../../features/template/twig/" class="dropdown-item">Using Twig</a>
</li>
            
<li>
    <a href="../../../features/template/laminas-view/" class="dropdown-item">Using laminas-view</a>
</li>
    </ul>
  </li>
            
<li>
    <a href="../../../features/error-handling/" class="dropdown-item">Error Handling</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Helpers</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../features/helpers/intro/" class="dropdown-item">Introduction</a>
</li>
            
<li>
    <a href="../../../features/helpers/url-helper/" class="dropdown-item">UrlHelper</a>
</li>
            
<li>
    <a href="../../../features/helpers/server-url-helper/" class="dropdown-item">ServerUrlHelper</a>
</li>
            
<li>
    <a href="../../../features/helpers/body-parse/" class="dropdown-item">Body Parsing Middleware</a>
</li>
    </ul>
  </li>
            
<li>
    <a href="../../../features/emitters/" class="dropdown-item">Emitters</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Cookbook</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../cookbook/common-prefix-for-routes/" class="dropdown-item">Prepending a common path to all routes</a>
</li>
            
<li>
    <a href="../../../cookbook/route-specific-pipeline/" class="dropdown-item">Route-specific middleware pipelines</a>
</li>
            
<li>
    <a href="../../../cookbook/custom-404-page-handling/" class="dropdown-item">Setting custom 404 page handling</a>
</li>
            
<li>
    <a href="../../../cookbook/using-custom-view-helpers/" class="dropdown-item">Registering custom view helpers when using laminas-view</a>
</li>
            
<li>
    <a href="../../../cookbook/using-laminas-form-view-helpers/" class="dropdown-item">Using laminas-form view helpers</a>
</li>
            
<li>
    <a href="../../../cookbook/using-a-base-path/" class="dropdown-item">Using Mezzio from a subdirectory</a>
</li>
            
<li>
    <a href="../../../cookbook/modular-layout/" class="dropdown-item">Building modular applications</a>
</li>
            
<li>
    <a href="../../../cookbook/setting-locale-depending-routing-parameter/" class="dropdown-item">Setting a locale based on a routing parameter</a>
</li>
            
<li>
    <a href="../../../cookbook/setting-locale-without-routing-parameter/" class="dropdown-item">Setting a locale without a routing parameter</a>
</li>
            
<li>
    <a href="../../../cookbook/debug-toolbars/" class="dropdown-item">Enabling debug toolbars</a>
</li>
            
<li>
    <a href="../../../cookbook/using-routed-middleware-class-as-controller/" class="dropdown-item">Handling multiple routes in a single class</a>
</li>
            
<li>
    <a href="../../../cookbook/flash-messengers/" class="dropdown-item">Flash Messengers</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Reference</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../why-mezzio/" class="dropdown-item">Why choose Mezzio?</a>
</li>
            
<li>
    <a href="../../usage-examples/" class="dropdown-item">Examples</a>
</li>
            
<li>
    <a href="../../mezzio-projects/" class="dropdown-item">Mezzio Projects</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Migration</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../rc-to-v1/" class="dropdown-item">From RC5 and Earlier</a>
</li>
            
<li>
    <a href="./" class="dropdown-item active">To Mezzio 1.1</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">_hidden-legacy-page-links <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../../../getting-started/features/" class="dropdown-item">_getting_started_overview</a>
</li>
                                    
<li>
    <a href="../../../../getting-started/standalone/" class="dropdown-item">_getting_started_standalone</a>
</li>
                                    
<li>
    <a href="../../../../getting-started/skeleton/" class="dropdown-item">_getting_started_skeleton</a>
</li>
                                    
<li>
    <a href="../../../../features/middleware-types/" class="dropdown-item">_features_middleware_types</a>
</li>
                                    
<li>
    <a href="../../../../features/application/" class="dropdown-item">_features_application</a>
</li>
                                    
<li>
    <a href="../../../../features/container/intro/" class="dropdown-item">_features_container_intro</a>
</li>
                                    
<li>
    <a href="../../../../features/container/factories/" class="dropdown-item">_features_container_factories</a>
</li>
                                    
<li>
    <a href="../../../../features/container/delegator-factories/" class="dropdown-item">_features_container_delegator_factories</a>
</li>
                                    
<li>
    <a href="../../../../features/container/laminas-servicemanager/" class="dropdown-item">_features_container_using_laminas-servicemanager</a>
</li>
                                    
<li>
    <a href="../../../../features/container/pimple/" class="dropdown-item">_features_container_using_pimple</a>
</li>
                                    
<li>
    <a href="../../../../features/container/aura-di/" class="dropdown-item">_features_container_using_aura.di</a>
</li>
                                    
<li>
    <a href="../../../../features/router/intro/" class="dropdown-item">_features_router_introduction</a>
</li>
                                    
<li>
    <a href="../../../../features/router/interface/" class="dropdown-item">_features_router_interface</a>
</li>
                                    
<li>
    <a href="../../../../features/router/uri-generation/" class="dropdown-item">_features_router_uri_generation</a>
</li>
                                    
<li>
    <a href="../../../../features/router/piping/" class="dropdown-item">_features_router_piping</a>
</li>
                                    
<li>
    <a href="../../../../features/router/aura/" class="dropdown-item">_features_router_using_aura</a>
</li>
                                    
<li>
    <a href="../../../../features/router/fast-route/" class="dropdown-item">_features_router_using_fastroute</a>
</li>
                                    
<li>
    <a href="../../../../features/router/laminas-router/" class="dropdown-item">_features_router_using_the Laminas Router</a>
</li>
                                    
<li>
    <a href="../../../../features/template/intro/" class="dropdown-item">_features_template_intro</a>
</li>
                                    
<li>
    <a href="../../../../features/template/interface/" class="dropdown-item">_features_template_interface</a>
</li>
                                    
<li>
    <a href="../../../../features/template/middleware/" class="dropdown-item">_features_template_middleware</a>
</li>
                                    
<li>
    <a href="../../../../features/template/plates/" class="dropdown-item">_features_template_plates</a>
</li>
                                    
<li>
    <a href="../../../../features/template/twig/" class="dropdown-item">_features_template_twig</a>
</li>
                                    
<li>
    <a href="../../../../features/template/laminas-view/" class="dropdown-item">_features_template_laminas-view</a>
</li>
                                    
<li>
    <a href="../../../../features/error-handling/" class="dropdown-item">_features_error_handling</a>
</li>
                                    
<li>
    <a href="../../../../features/modular-applications/" class="dropdown-item">_features_modular_applications</a>
</li>
                                    
<li>
    <a href="../../../../features/middleware/implicit-methods-middleware/" class="dropdown-item">_features_middleware_implicit_head_and_options_middleware</a>
</li>
                                    
<li>
    <a href="../../../../features/helpers/intro/" class="dropdown-item">_features_helpers_intro</a>
</li>
                                    
<li>
    <a href="../../../../features/helpers/url-helper/" class="dropdown-item">_features_helpers_urlhelper</a>
</li>
                                    
<li>
    <a href="../../../../features/helpers/server-url-helper/" class="dropdown-item">_features_helpers_serverurlhelper</a>
</li>
                                    
<li>
    <a href="../../../../features/helpers/body-parse/" class="dropdown-item">_features_helpers_body_parsing_middleware</a>
</li>
                                    
<li>
    <a href="../../../../features/helpers/content-length/" class="dropdown-item">_features_helpers_content_length_middleware</a>
</li>
                                    
<li>
    <a href="../../../../features/emitters/" class="dropdown-item">_features_emitters</a>
</li>
                                    
<li>
    <a href="../../../../cookbook/autowiring-routes-and-pipelines/" class="dropdown-item">_cookbook_autowiring_routes_and_pipeline_middleware</a>
</li>
                                    
<li>
    <a href="../../../../cookbook/common-prefix-for-routes/" class="dropdown-item">_cookbook_prepending_a_common_path_to_all_routes</a>
</li>
                                    
<li>
    <a href="../../../../cookbook/route-specific-pipeline/" class="dropdown-item">_cookbook_route-specific_middleware_pipelines</a>
</li>
                                    
<li>
    <a href="../../../../cookbook/custom-404-page-handling/" class="dropdown-item">_cookbook_setting_custom_404_page_handling</a>
</li>
                                    
<li>
    <a href="../../../../cookbook/using-custom-view-helpers/" class="dropdown-item">_cookbook_registering_custom_view_helpers_when_using_laminas-view</a>
</li>
                                    
<li>
    <a href="../../../../cookbook/using-laminas-form-view-helpers/" class="dropdown-item">_cookbook_using_laminas-form_view_helpers</a>
</li>
                                    
<li>
    <a href="../../../../cookbook/using-a-base-path/" class="dropdown-item">_cookbook_using_Mezzio_from_a_subdirectory</a>
</li>
                                    
<li>
    <a href="../../../../cookbook/modular-layout/" class="dropdown-item">_cookbook_building_modular_applications</a>
</li>
                                    
<li>
    <a href="../../../../cookbook/setting-locale-depending-routing-parameter/" class="dropdown-item">_cookbook_setting_a_locale_based_on_a_routing_parameter</a>
</li>
                                    
<li>
    <a href="../../../../cookbook/setting-locale-without-routing-parameter/" class="dropdown-item">_cookbook_setting_a_locale_without_a_routing_parameter</a>
</li>
                                    
<li>
    <a href="../../../../cookbook/debug-toolbars/" class="dropdown-item">_cookbook_enabling_debug_toolbars</a>
</li>
                                    
<li>
    <a href="../../../../cookbook/using-routed-middleware-class-as-controller/" class="dropdown-item">_cookbook_handling_multiple_routes_in_a_single_class</a>
</li>
                                    
<li>
    <a href="../../../../cookbook/flash-messengers/" class="dropdown-item">_cookbook_flash_messengers</a>
</li>
                                    
<li>
    <a href="../../../../cookbook/passing-data-between-middleware/" class="dropdown-item">_cookbook_passing_data_between_middleware</a>
</li>
                                    
<li>
    <a href="../../../../why-mezzio/" class="dropdown-item">_reference_why_mezzio?</a>
</li>
                                    
<li>
    <a href="../../../../reference/cli-tooling/" class="dropdown-item">_reference_cli_tooling</a>
</li>
                                    
<li>
    <a href="../../../../reference/usage-examples/" class="dropdown-item">_reference_usage_examples</a>
</li>
                                    
<li>
    <a href="../../../../reference/mezzio-projects/" class="dropdown-item">_reference_mezzio_Projects</a>
</li>
                                    
<li>
    <a href="../../../../reference/migration/to-v2/" class="dropdown-item">_migration_to_v2</a>
</li>
                                    
<li>
    <a href="../../../../reference/migration/rc-to-v1/" class="dropdown-item">_migration_from_rc5_and_earlier</a>
</li>
                                    
<li>
    <a href="../../../../reference/migration/to-v1-1/" class="dropdown-item">_migration_to_mezzio_1.1</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../rc-to-v1/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../../../../getting-started/features/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="https://github.com/mezzio/mezzio/edit/master/docs/v1/reference/migration/to-v1-1.md" class="nav-link"><i class="fa fa-github"></i> Edit on GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#migration-to-mezzio-11" class="nav-link">Migration to Mezzio 1.1</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#deprecations" class="nav-link">Deprecations</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#original-messages" class="nav-link">Original messages</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#programmatic-middleware-pipelines" class="nav-link">Programmatic middleware pipelines</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#error-handling" class="nav-link">Error handling</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#full-example" class="nav-link">Full example</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#looking-forward" class="nav-link">Looking forward</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="migration-to-mezzio-11">Migration to Mezzio 1.1</h1>
<p>Mezzio 1.1 should not result in any upgrade problems for users. However,
starting in this version, we offer a few changes affecting the following that
you should be aware of, and potentially update your application to adopt:</p>
<ul>
<li>Deprecations</li>
<li>Original request and response messages</li>
<li>Recommendation to use programmatic pipelines</li>
<li>Error handling</li>
</ul>
<h2 id="deprecations">Deprecations</h2>
<p>The following classes and/or methods are deprecated with the 1.1.0 release, and
will be removed for the 2.0 release:</p>
<ul>
<li>
<p><code>Mezzio\Application::pipeErrorHandler()</code>: Stratigility v1 error
  middleware are removed in the Stratigility v2 release, which Mezzio 2.0 will
  adopt.</p>
</li>
<li>
<p><code>Mezzio\Application::routeMiddleware()</code>: routing middleware moves to
  a dedicated class starting in Mezzio 2.0. If you were referencing the
  method in order to pipe it as middleware, use <code>pipeRoutingMiddleware()</code> or
  <code>pipe(ApplicationFactory::ROUTING_MIDDLEWARE)</code> instead.</p>
</li>
<li>
<p><code>Mezzio\Application::dispatchMiddleware()</code>: dispatch middleware moves
  to a dedicated class starting in Mezzio 2.0.If you were referencing the
  method in order to pipe it as middleware, use <code>pipeDispatchMiddleware()</code> or
  <code>pipe(ApplicationFactory::DISPATCH_MIDDLEWARE)</code> instead.</p>
</li>
<li>
<p><code>Mezzio\Application::getFinalHandler()</code>: this method gets renamed to
  <code>getDefaultDelegate()</code> in Mezzio 2.0. We recommend retrieving the value
  from the application dependency injection container if you need it elsewhere.</p>
</li>
<li>
<p><code>Mezzio\Application::raiseThrowables()</code>: this method becomes a no-op
  in Stratigility 2.0, on which Mezzio 2.0 is based; the behavior it enabled
  becomes the default behavior in that version.</p>
</li>
<li>
<p><code>Mezzio\Container\Exception\InvalidArgumentException</code>: this exception
  type is thrown by <code>ApplicationFactory</code>; in Mezzio 2.0, it throws
  <code>Mezzio\Exception\InvalidArgumentException</code> instead.</p>
</li>
<li>
<p><code>Mezzio\Container\Exception\NotFoundException</code>: this exception type
  is not currently used anyways.</p>
</li>
<li>
<p><code>Mezzio\ErrorMiddlewarePipe</code>: Stratigility v1 error middleware are
  removed in the Stratigility v2 release, which Mezzio 2.0 will adopt,
  making this specialized middleware pipe type irrelvant.</p>
</li>
<li>
<p><code>Mezzio\TemplatedErrorHandler</code> and <code>Mezzio\WhoopsErrorHandler</code>:
  The concept of "final handlers" will be removed in Mezzio 2.0, to be
  replaced with "default delegates" (implementations of
  <code>Interop\Http\ServerMiddleware\DelegateInterface</code> that will be called if the
  middleware pipeline is exhausted, and which will be guaranteed to return a
  response). Mezzio 2.0 will provide tooling to upgrade your dependencies to
  make the transition seamless; end users will only be affected if they were
  extending these classes.</p>
</li>
</ul>
<p>If you were calling any of these directly, or extending or overriding them, you
will need to update your code to work for version 2.0. We recommend not using
these.</p>
<h2 id="original-messages">Original messages</h2>
<p>Stratigility 1.3 deprecates its internal request and response decorators,
<code>Laminas\Stratigility\Http\Request</code> and <code>Laminas\Stratigility\Http\Response</code>,
respectively. The main utility of these instances was to provide access in
inner middleware layers to the original request, original response, and original
URI.</p>
<p>As such access may still be desired, Stratigility 1.3 introduced
<code>Laminas\Stratigility\Middleware\OriginalMessages</code>. This middleware injects the
following attributes into the request it passes to <code>$next()</code>:</p>
<ul>
<li><code>originalRequest</code> is the request instance provided to the middleware.</li>
<li><code>originalUri</code> is the URI instance associated with that request.</li>
<li><code>originalResponse</code> is the response instance provided to the middleware.</li>
</ul>
<p><code>Laminas\Stratigility\FinalHandler</code> was updated to use these when they're
available starting with version 1.0.3.</p>
<p>We recommend adding the <code>OriginalMessages</code> middleware as the outermost (first)
middleware in your pipeline. Using configuration-driven middleware, that would
look like this:</p>
<pre><code class="php">// config/autoload/middleware-pipeline.global.php
/* ... */
use Mezzio\Helper;
use Laminas\Stratigility\Middleware\OriginalMessages;

return [
    'dependencies' =&gt; [
        'invokables' =&gt; [
            OriginalMessages::class =&gt; OriginalMessages::class,
        ],
        /* ... */
    ],
    'middleware_pipeline' =&gt; [
        'always' =&gt; [
            'middleware' =&gt; [
                OriginalMessages::class, // &lt;----- Add this entry
                Helper\ServerUrlMiddleware::class,
                /* ... */
            ],
            'priority' =&gt; 10000,
        ],

        /* ... */
    ],
];
</code></pre>

<p>If you are <a href="https://mwop.net/blog/2016-05-16-programmatic-expressive.html">programmatically creating your pipeline</a>,
use the following:</p>
<pre><code class="php">$app-&gt;pipe(OriginalMessages::class);
/* all other middleware */
</code></pre>

<h3 id="identifying-and-fixing-getoriginal-calls">Identifying and fixing getOriginal calls</h3>
<p>To help you identify and update calls in your own code to the <code>getOriginal*()</code>
methods, we provide a tool via the <a href="https://github.com/mezzio/mezzio-tooling">mezzio/mezzio-tooling</a>
package, <code>vendor/bin/mezzio-migrate-original-messages</code>.</p>
<p>First, install the tooling package; since the tooling it provides is only
useful during development, install it as a development requirement:</p>
<pre><code class="bash">$ composer require --dev mezzio/mezzio-tooling
</code></pre>

<p>Once installed,  you can execute the tool using:</p>
<pre><code class="bash">$ ./vendor/bin/mezzio-migrate-original-messages
</code></pre>

<p>Passing the arguments <code>help</code>, <code>--help</code>, or <code>-h</code> will provide usage information;
in most cases, it will assume sane defaults in order to run its scans.</p>
<p>The tool updates calls to <code>getOriginalRequest()</code> and <code>getOriginalUri()</code> to
instead use the new request attributes that the <code>OriginalMessages</code> middleware
injects:</p>
<ul>
<li><code>getOriginalRequest()</code> becomes <code>getAttribute('originalRequest', $request)</code></li>
<li><code>getOriginalUri()</code> becomes <code>getAttribute('originalUri', $request-&gt;getUri())</code></li>
</ul>
<p>In both cases, <code>$request</code> will be replaced with whatever variable name you used
for the request instance.</p>
<p>For <code>getOriginalResponse()</code> calls, which happen on the response instance, the
tool will instead tell you what files had such calls, and detail how you can
update those calls to use the <code>originalResponse</code> request attribute.</p>
<h2 id="programmatic-middleware-pipelines">Programmatic middleware pipelines</h2>
<p>With Mezzio 1.0, we recommended creating middleware pipelines and routing
via configuration. Starting with 1.1, we recommend <em>programmatic creation of
pipelines and routing</em>.</p>
<p>Programmatic pipelines exercise the existing Mezzio API. Methods include:</p>
<ul>
<li>
<p><code>pipe()</code> allows you to pipe middleware for the pipeline; this can optionally
  take a <code>$path</code> argument. (If one argument is present, it is assumed to be
  middleware; with two arguments, the first argument is the <code>$path</code>.) Paths are
  literal URI path segments. If the incoming request matches that segment, the
  middleware will execute; otherwise, it will not. These can be used to provide
  sub-applications with their own routing.</p>
</li>
<li>
<p><code>pipeRoutingMiddleware()</code> is used to pipe the internal routing middleware into
  the pipeline.</p>
</li>
<li>
<p><code>pipeDispatchMiddleware()</code> is used to pipe the internal dispatch middleware into
  the pipeline.</p>
</li>
<li>
<p><code>pipeErrorMiddleware()</code> is used to pipe the legacy Stratigility error
  middleware into the pipeline. We recommend <strong>NOT</strong> using this method, and
  instead adapting your application to use <a href="#error-handling">standard middleware for error
  handling</a>. Otherwise, it acts just like <code>pipe()</code>.
  Starting in Mezzio 1.1, this method will emit a deprecation notice.</p>
</li>
</ul>
<p>As an example pipeline:</p>
<pre><code class="php">$app-&gt;pipe(OriginalMessages::class);
$app-&gt;pipe(Helper\ServerUrlMiddleware::class);
$app-&gt;pipe(ErrorHandler::class);
$app-&gt;pipeRoutingMiddleware();
$app-&gt;pipe(Helper\UrlHelperMiddleware::class);
$app-&gt;pipeDispatchMiddleware();
$app-&gt;pipe(NotFoundHandler::class);
</code></pre>

<p>Mezzio also provides methods for specifying routed middleware. These
include:</p>
<ul>
<li><code>get($path, $middleware, $name = null)</code></li>
<li><code>post($path, $middleware, $name = null)</code></li>
<li><code>put($path, $middleware, $name = null)</code></li>
<li><code>patch($path, $middleware, $name = null)</code></li>
<li><code>delete($path, $middleware, $name = null)</code></li>
<li><code>route($path, $middleware, array $methods = null, $name = null)</code></li>
</ul>
<p>Each returns a <code>Mezzio\Router\Route</code> instance; this is useful if you
wish to provide additional options to your route:</p>
<pre><code class="php">$app-&gt;get('/api/ping', Ping::class)
    -&gt;setOptions([
        'timestamp' =&gt; date(),
    ]);
</code></pre>

<p>As an example, the default routes defined in the skeleton application can be
written as follows:</p>
<pre><code class="php">$app-&gt;get('/', \App\Action\HomePageAction::class, 'home');
$app-&gt;get('/api/ping', \App\Action\PingAction::class, 'api.ping');
</code></pre>

<p>We recommend rewriting your middleware pipeline and routing configuration into
programmatic/declarative statements. Specifically:</p>
<ul>
<li>We recommend putting the pipeline declarations into <code>config/pipeline.php</code>.</li>
<li>We recommend putting the routing declarations into <code>config/routes.php</code>.</li>
</ul>
<p>Once you've written these, you will then need to make the following changes to
your application:</p>
<ul>
<li>First, enable the <code>mezzio.programmatic_pipeline</code> configuration flag.
  This can be done in any <code>config/autoload/*.global.php</code> file:</li>
</ul>
<p><code>php
  return [
      'mezzio' =&gt; [
          'programmatic_pipeline' =&gt; true,
      ],
  ];</code></p>
<p>Once enabled, any <code>middleware_pipeline</code> or <code>routes</code> configuration will be
  ignored when creating the <code>Application</code> instance.</p>
<ul>
<li>Second, update your <code>public/index.php</code> to add the following lines immediately
  prior to calling <code>$app-&gt;run();</code>:</li>
</ul>
<p><code>php
  require 'config/pipeline.php';
  require 'config/routes.php';</code></p>
<p>Once this has been done, the application will use your new programmatic
pipelines instead of configuration. You can remove the <code>middleware_pipeline</code> and
<code>routes</code> configuration after verifying your application continues to work.</p>
<p>For programmatic pipelines to work properly, you will also need to provide error
handling middleware, which is discussed in the next section.</p>
<h2 id="error-handling">Error handling</h2>
<p>Prior to version 1.1, error handling was accomplished via two mechanisms:</p>
<ul>
<li>Stratigility "error middleware" (middleware with the signature <code>function
  ($error, ServerRequestInterface $request, ResponseInterface $response,
  callable $next)</code>). This middleware would be invoked when calling <code>$next()</code>
  with a third argument indicating an error, and would be expected to handle it
  or delegate to the next error middleware.</li>
</ul>
<p>Internally, Stratigility would execute each middleware within a try/catch
  block; if an exception were caught, it would then delegate to the next <em>error
  middleware</em> using the caught exception as the <code>$err</code> argument.</p>
<ul>
<li>The "Final Handler". This is a handler invoked when the middleware pipeline is
  exhausted without returning a response, and has the signature <code>function
  (ServerRequestInterface $request, ResponseInterface $response, $err = null)</code>;
  it is provided to the middleware pipeline when invoking the outermost
  middleware; in the case of Mezzio, it is composed in the <code>Application</code>
  instance, and passed to the application middleware when it executes <code>run()</code>.
  When invoked, it needs to decide if invocation is due to no middleware
  executing (HTTP 404 status), middleware calling <code>$next()</code> with an altered
  response (response is then returned), or due to invocation of error middleware
  (calling <code>$next()</code> with the third, error, argument) with no error middleware
  returning a response.</li>
</ul>
<p>Mezzio 1.1 updates the minimum supported Stratigility version to 1.3, which
deprecates the concept of error middleware, and recommends a "final handler"
that does no error handling, but instead returns a canned response (typically a
404). Additionally, it deprecates the practice of wrapping middleware execution
in a try/catch block, and provides a flag for disabling that behavior entirely,
<code>raise_throwables</code>.</p>
<p>Starting in Mezzio 1.1, you can set the <code>raise_throwables</code> flag in your
configuration:</p>
<pre><code class="php">return [
    'mezzio' =&gt; [
        'raise_throwables' =&gt; true,
    ],
];
</code></pre>

<p>When enabled, the internal dispatcher will no longer catch exceptions.</p>
<p>This both allows you to, and <em>requires</em> you to, write your own error handling
middleware. This will require two things:</p>
<ul>
<li>Middleware with a try/catch block that operates as the outermost (or close to
  outermost) layer of your application, and which can provide error pages or
  details to your end users.</li>
<li>Middleware at the innermost layer that is guaranteed to return a response;
  generally, reaching this means no middleware was able to route the request, and
  thus a 404 condition.</li>
</ul>
<p>The below sections detail approaches to each.</p>
<h3 id="error-handling-middleware">Error handling middleware</h3>
<p>Error handling middleware generally will look something like this:</p>
<pre><code class="php">function (
    ServerRequestInterface $request,
    ResponseInterface $response,
    callable $next
) {
    try {
        $response = $next($request, $response);
        return $response;
    } catch (\Throwable $exception) {
        // caught PHP 7 throwable
    } catch (\Exception $exception) {
        // caught PHP 5 exception
    }

    // ...
    // do something with $exception and generate a response
    // ...

    return $response;
}
</code></pre>

<p>Stratigility 1.3 provides such an implementation via its
<code>Laminas\Stratigility\Middleware\ErrorHandler</code>. In addition to the try/catch block,
it also sets up a PHP error handler that will catch any PHP error types in the
current <code>error_reporting</code> mask; the error handler will raise exceptions of the
type <code>ErrorException</code> with the PHP error details.</p>
<p>Stratigility's <code>ErrorHandler</code> allows injection of an "error response generator",
which allows you to alter how the error response is generated based on the
current environment. Error response generators are callables with the signature:</p>
<pre><code class="php">function (
    Throwable|Exception $e,
    ServerRequestInterface $request,
    ResponseInterface $response
) : ResponseInterface
</code></pre>

<p>We recommend using the Stratigility <code>ErrorHandler</code> and writing and attaching a
custom error response generator. As a simple example, the following details a
generator that will use a template to display an error page:</p>
<pre><code class="php">namespace Acme;

use Psr\Http\Message\ResponseInterface;
use Psr\Http\Message\ServerRequestInterface;
use Mezzio\Template\TemplateRendererInterface;

class TemplatedErrorResponseGenerator
{
    const TEMPLATE_DEFAULT = 'error::error';

    private $renderer;

    private $template;

    public function __construct(
        TemplateRendererInterface $renderer,
        $template = TEMPLATE_DEFAULT
    ) {
        $this-&gt;renderer = $renderer;
        $this-&gt;template = $template;
    }

    public function __invoke(
        $e,
        ServerRequestInterface $request,
        ResponseInterface $response
    ) {
        $response-&gt;write($this-&gt;renderer-&gt;render($this-&gt;template, [
            'exception' =&gt; $e,
            'request'   =&gt; $request,
        ]));
        return $response;
    }
}
</code></pre>

<p>You might then create a factory for generating the <code>ErrorHandler</code> and attaching
this response generator as follows:</p>
<pre><code class="php">namespace Acme\Container;

use Acme\TemplatedErrorResponseGenerator;
use Interop\Container\ContainerInterface;
use Laminas\Diactoros\Response;
use Mezzio\Template\TemplateRendererInterface;
use Laminas\Stratigility\Middleware\ErrorHandler;

class ErrorHandlerFactory
{
    public function __invoke(ContainerInterface $container)
    {
        $generator = new TemplatedErrorResponseGenerator(
            $container-&gt;get(TemplateRendererInterface::class)
        );

        return new ErrorHandler(new Response(), $generator);
    }
}
</code></pre>

<p>Once that is created you can tell your middleware configuration about it:</p>
<pre><code class="php">// in config/autoload/middleware-pipeline.global.php
use Acme\Container\ErrorHandlerFactory;
use Laminas\Stratigility\Middleware\ErrorHandler;

return [
    'dependencies' =&gt; [
        /* ... */
        'factories' =&gt; [
            ErrorHandler::class =&gt; ErrorHandlerFactory::class,
            /* ... */
        ],
        /* ... */
    ],
    'middleware_pipeline' =&gt; [
        'always' =&gt; [
            'middleware' =&gt; [
                ErrorHandler::class,
                /* ... */
            ],
            'priority' =&gt; 10000,
        ],
        /* ... */
    ],
];
</code></pre>

<p>Alternately, if using a programmatic pipeline, as detailed in the previous
section, you can use the following:</p>
<pre><code class="php">use Laminas\Stratigility\Middleware\ErrorHandler;

$app-&gt;pipe(ErrorHandler::class);
// add all other middleware after it
</code></pre>

<h3 id="not-found-middleware">Not Found middleware</h3>
<p>At the innermost layer of your application, you need middleware guaranteed to
return a response; typically, this indicates a failure to route the request,
and, as such, an HTTP 404 response.  <code>Laminas\Stratigility\Middleware\NotFoundHandler</code>
provides an implementation, but is written such that the response body remains
empty. As such, you might write a custom, templated handler:</p>
<pre><code class="php">namespace Acme;

use Psr\Http\Message\ResponseInterface;
use Psr\Http\Message\ServerRequestInterface;
use Laminas\Diactoros\Response;
use Mezzio\Template\TemplateRendererInterface;

class TemplatedNotFoundHandler
{
    const TEMPLATE_DEFAULT = 'error::404';

    private $renderer;

    private $template;

    public function __construct(
        TemplateRendererInterface $renderer,
        $template = self::TEMPLATE_DEFAULT
    ) {
        $this-&gt;renderer = $renderer;
        $this-&gt;template = $template;
    }

    public function __invoke(
        ServerRequestInterface $request,
        ResponseInterface $response,
        callable $next
    ) {
        $response = new Response();
        $response-&gt;write($this-&gt;renderer-&gt;render($this-&gt;template));
        return $response-&gt;withStatus(404);
    }
}
</code></pre>

<p>Similar to the discussion of the <code>ErrorHandler</code> above, we'll create a factory
for this:</p>
<pre><code class="php">namespace Acme\Container;

use Acme\TemplatedNotFoundHandler;
use Interop\Container\ContainerInterface;
use Mezzio\Template\TemplateRendererInterface;

class TemplatedNotFoundHandlerFactory
{
    public function __invoke(ContainerInterface $container)
    {
        return new TemplatedNotFoundHandler(
            $container-&gt;get(TemplateRendererInterface::class)
        );
    }
}
</code></pre>

<p>We can then register it in our pipeline:</p>
<pre><code class="php">// in config/autoload/middleware-pipeline.global.php
use Acme\Container\NotFoundHandlerFactory;
use Acme\TemplatedNotFoundHandler;

return [
    'dependencies' =&gt; [
        /* ... */
        'factories' =&gt; [
            TemplatedNotFoundHandler::class =&gt; TemplatedNotFoundHandlerFactory::class,
            /* ... */
        ],
        /* ... */
    ],
    'middleware_pipeline' =&gt; [
        /* ... */

        // After 'routing', but before 'error';
        // alternately as last item in 'routing' middleware list.
        'not-found' =&gt; [
            'middleware' =&gt; TemplatedNotFoundHandler::class,
            'priority' =&gt; 0,
        ],

        /* ... */
    ],
];
</code></pre>

<p>If you are using programmatic pipelines, as described in the previous section:</p>
<pre><code class="php">use Acme\TemplatedNotFoundHandler;

// all other pipeline directives, and then:
$app-&gt;pipe(TemplatedNotFoundHandler::class);
</code></pre>

<h3 id="detecting-error-middleware-usage">Detecting error middleware usage</h3>
<p>If you use the new error handling paradigm, we recommend that you also audit
your application for legacy Stratigility error middleware, as well as invocation
of error middleware. To do this, we provide a tool via the
<a href="https://github.com/mezzio/mezzio-tooling">mezzio/mezzio-tooling</a>
package, <code>vendor/bin/mezzio-scan-for-error-middleware</code>.</p>
<p>First, install the tooling as a development requirement:</p>
<pre><code class="bash">$ composer require --dev mezzio/mezzio-tooling
</code></pre>

<p>The tool will scan the <code>src/</code> directory by default, but allows you to scan other
directories via the <code>--dir</code> flag. It will detect and report files with any of
the following:</p>
<ul>
<li>Classes implementing <code>Laminas\Stratigility\ErrorMiddlewareInterface</code>.</li>
<li>Invokable classes implementing the error middleware signature.</li>
<li>Methods accepting <code>$next</code> that invoke it with an error argument.</li>
</ul>
<p>As an example running it:</p>
<pre><code class="bash">$ ./vendor/bin/mezzio-scan-for-error-middleware scan
# or, with a directory argument:
$ ./vendor/bin/mezzio-scan-for-error-middleware scan --dir ./lib
</code></pre>

<p>You may also call the tool using its <code>help</code> command, or either of the <code>--help</code>
or <code>-h</code> flags to get full usage information.</p>
<p>Use this tool to identify potential problem areas in your application, and
update your code to use the new error handling facilities as outlined above.</p>
<h2 id="full-example">Full example</h2>
<p>Putting all of the above together &mdash; <a href="#original-messages">original message
memoizing</a>, <a href="#programmatic-middleware-pipelines">programmatic
pipelines</a>, and <a href="#error-handling">middleware-based error
handling</a> &mdash; might look like the following examples.</p>
<p>First, we'll tell Mezzio to use programmatic pipelines, and to enable the
new error handling (by telling it to "raise throwables", instead of catching
them):</p>
<pre><code class="php">// In config/autoload/mezzio.global.php:
return [
    /* ... */
    'mezzio' =&gt; [
        'programmatic_pipeline' =&gt; true,
        'raise_throwables' =&gt; true,
        /* ... */
    ],
];
</code></pre>

<p>Next, we'll update <code>config/autoload/middleware-pipeline.global.php</code> to list only
dependencies:</p>
<pre><code class="php">use Acme\Container;
use Acme\TemplatedNotFoundHandler;
use Laminas\Stratigility\Middleware\ErrorHandler;
use Laminas\Stratigility\Middleware\OriginalMessages;
use Mezzio\Helper;

return [
    'dependencies' =&gt; [
        'invokables' =&gt; [
            OriginalMessages::class =&gt; OriginalMesssages::class,
        ],
        'factories' =&gt; [
            ErrorHandler::class =&gt; Container\ErrorHandlerFactory::class,
            Helper\ServerUrlMiddleware::class =&gt; Helper\ServerUrlMiddlewareFactory::class,
            Helper\UrlHelperMiddleware::class =&gt; Helper\UrlHelperMiddlewareFactory::class,
            TemplatedNotFoundHandler::class =&gt; Container\TemplatedNotFoundHandlerFactory::class,
        ],
    ],
];
</code></pre>

<p>We'll also update <code>config/autoload/routes.global.php</code> to only list dependencies;
in the following example, we list only the middleware shipped by default with
the skeleton application:</p>
<pre><code class="php">use App\Action;
use Mezzio\Router\FastRouteRouter;
use Mezzio\Router\RouterInterface;

return [
    'dependencies' =&gt; [
        'invokables' =&gt; [
            RouterInterface::class =&gt; FastRouteRouter::class,
            Action\PingAction::class =&gt; Action\PingAction::class,
        ],
        'factories' =&gt; [
            Action\HomePageAction::class =&gt; Action\HomePageFactory::class,
        ],
    ],
];
</code></pre>

<p>To create our pipeline, we will create the file <code>config/pipeline.php</code>:</p>
<pre><code class="php">use Acme\TemplatedNotFoundHandler;
use Laminas\Stratigility\Middleware\ErrorHandler;
use Laminas\Stratigility\Middleware\OriginalMessages;
use Mezzio\Container\ApplicationFactory;
use Mezzio\Helper;

$app-&gt;pipe(OriginalMessages::class);
$app-&gt;pipe(ErrorHandler::class);
$app-&gt;pipe(Helper\ServerUrlMiddleware::class);
$app-&gt;pipe([
    ApplicationFactory::ROUTING_MIDDLEWARE,
    Helper\UrlHelperMiddleware::class,
    ApplicationFactory::DISPATCH_MIDDLEWARE,
]);
$app-&gt;pipe(TemplatedNotFoundHandler::class);
</code></pre>

<p>Note that you can use <em>arrays</em> of middleware just like you did in the
configuration; this allows you to separate middleware into logical groups if
desired!</p>
<p>To provide our routed middleware, we will create the file
<code>config/pipeline.php</code>:</p>
<pre><code class="php">use App\Action;

$app-&gt;get('/', Action\HomePageAction::class, 'home');
$app-&gt;get('/api/ping', Action\PingAction::class, 'api.ping');
</code></pre>

<p>The above exercises the various routing methods of the <code>Application</code> class.</p>
<p>Finally, we will need to update our <code>public/index.php</code>, to tell it to require
our new pipeline and routing files; we'll do that between retrieving the
application from the container, and running the application:</p>
<pre><code class="php">$app = $container-&gt;get(\Mezzio\Application::class);
require 'config/pipeline.php';
require 'config/routes.php';
$app-&gt;run();
</code></pre>

<p>With these changes in place, your application should continue to run as it did
previously!</p>
<h2 id="looking-forward">Looking forward</h2>
<p>Mezzio 2.0 will ship error handling middleware and "not found" middleware,
as well as tools to convert your application to a programmatic pipeline in such
a way as to utilize these shipped implementations. In the meantime, however, you
can adopt programmatic pipelines and the new error handling paradigm within the
version 1 series using the configuration flags and guidelines listed above in
order to make your application forwards-compatible.</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../../../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../../../js/base.js" defer></script>
        <script src="../../../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <div class="table-responsive"><table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
